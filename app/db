CREATE DATABASE IF NOT EXISTS talkgamebot_db;
USE talkgamebot_db;
ALTER DATABASE talkgamebot_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

CREATE TABLE Gamers (
    id BIGINT PRIMARY KEY,
    nickname VARCHAR(63)
);

CREATE TABLE Admins (
    id BIGINT PRIMARY KEY,
    nickname VARCHAR(63)
);

CREATE TABLE Games (
    id INT PRIMARY KEY,
    game_start DATETIME,
    game_end DATETIME
);

CREATE TABLE Questions_Actions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_admin BIGINT,
    questions_or_actions BOOLEAN,
    category VARCHAR(127),
    task TEXT,
    UNIQUE(task),
    FOREIGN KEY (id_admin) REFERENCES Admins(id)
);

CREATE TABLE Questions_Actions_From_Gamers (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_gamer BIGINT,
    task TEXT,
    FOREIGN KEY (id_gamer) REFERENCES Gamers(id)
);

CREATE TABLE Answers (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_game INT,
    id_gamer BIGINT,
    id_question_action INT,
    id_question_action_from_gamer INT,
    from_game_or_gamer BOOLEAN,
    answer_start DATETIME,
    answer_end DATETIME,
    score INT,
    FOREIGN KEY (id_game) REFERENCES Games(id),
    FOREIGN KEY (id_gamer) REFERENCES Gamers(id),
    FOREIGN KEY (id_question_action) REFERENCES Questions_Actions(id),
    FOREIGN KEY (id_question_action_from_gamer) REFERENCES Questions_Actions_From_Gamers(id)
);

CREATE TABLE Participates (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_game INT,
    id_gamer BIGINT,
    connection_time DATETIME,
    disconnection_time DATETIME,
    FOREIGN KEY (id_game) REFERENCES Games(id),
    FOREIGN KEY (id_gamer) REFERENCES Gamers(id)
);


ALTER TABLE Questions_Actions CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE Questions_Actions_From_Gamers CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE Gamers CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE Admins CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;